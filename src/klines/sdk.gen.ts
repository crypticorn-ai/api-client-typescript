import {
  createClient as createNativeClient,
  createConfig,
  type OptionsLegacyParser,
} from "@hey-api/client-fetch";

import type {
  PingError,
  PingResponse,
  GetTimeData,
  GetTimeError,
  GetTimeResponse,
  GetUdfConfigError,
  GetUdfConfigResponse,
  SearchSymbolsData,
  SearchSymbolsError,
  SearchSymbolsResponse,
  GetSymbolData,
  GetSymbolError,
  GetSymbolResponse,
  GetUdfHistoryData,
  GetUdfHistoryError,
  GetUdfHistoryResponse,
  GetSymbolInfoData,
  GetSymbolInfoError,
  GetSymbolInfoResponse,
  OptionsHandlerData,
  OptionsHandlerError,
  OptionsHandlerResponse,
  GetLogLevelError,
  GetLogLevelResponse,
  GetUptimeData,
  GetUptimeError,
  GetUptimeResponse,
  GetMemoryUsageError,
  GetMemoryUsageResponse,
  GetThreadsError,
  GetThreadsResponse,
  GetContainerLimitsError,
  GetContainerLimitsResponse,
  GetDependenciesData,
  GetDependenciesError,
  GetDependenciesResponse,
  GetOhlcvData,
  GetOhlcvError,
  GetOhlcvResponse,
  GetFundingRatesData,
  GetFundingRatesError,
  GetFundingRatesResponse,
  GetKlinesSymbolsData,
  GetKlinesSymbolsError,
  GetKlinesSymbolsResponse,
  GetChangeInTimeframeData,
  GetChangeInTimeframeError,
  GetChangeInTimeframeResponse,
} from "./types.gen";

export function createClient(
  baseUrl: string,
  headers: any,
  fetch = globalThis.fetch,
) {
  const client = createNativeClient(
    createConfig({
      baseUrl,
      fetch,
      headers,
    }),
  );

  // This file is auto-generated by @hey-api/openapi-ts

  /**
   * Ping
   * Returns 'OK' if the API is running.
   */
  const ping = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      PingResponse,
      PingError,
      ThrowOnError
    >({
      ...options,
      url: "/",
    });
  };

  /**
   * Time
   * Returns the current time in either ISO or Unix timestamp (seconds) format.
   */
  const getTime = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetTimeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetTimeResponse,
      GetTimeError,
      ThrowOnError
    >({
      ...options,
      url: "/time",
    });
  };

  /**
   * Get Config
   */
  const getUdfConfig = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetUdfConfigResponse,
      GetUdfConfigError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/config",
    });
  };

  /**
   * Search Symbols
   * Called when a user searches for symbols in TradingView
   */
  const searchSymbols = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<SearchSymbolsData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      SearchSymbolsResponse,
      SearchSymbolsError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/search",
    });
  };

  /**
   * Get Symbol
   */
  const getSymbol = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetSymbolData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetSymbolResponse,
      GetSymbolError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/symbols",
    });
  };

  /**
   * Get History
   */
  const getUdfHistory = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetUdfHistoryData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetUdfHistoryResponse,
      GetUdfHistoryError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/history",
    });
  };

  /**
   * @deprecated
   * Get Symbol Info
   * Handle symbol info requests for different groups
   */
  const getSymbolInfo = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetSymbolInfoData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetSymbolInfoResponse,
      GetSymbolInfoError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/symbol_info",
    });
  };

  /**
   * Options Handler
   * Handle OPTIONS requests for all UDF endpoints
   */
  const optionsHandler = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<OptionsHandlerData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).options<
      OptionsHandlerResponse,
      OptionsHandlerError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/{path}",
    });
  };

  /**
   * @deprecated
   * Get Logging Level
   * Get the log level of the server logger. Will be removed in a future release.
   */
  const getLogLevel = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetLogLevelResponse,
      GetLogLevelError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/log-level",
    });
  };

  /**
   * Get Uptime
   * Return the server uptime in seconds or human-readable form.
   */
  const getUptime = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetUptimeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetUptimeResponse,
      GetUptimeError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/uptime",
    });
  };

  /**
   * Get Memory Usage
   * Resident Set Size (RSS) in MB â€” the actual memory used by the process in RAM.
   * Represents the physical memory footprint. Important for monitoring real usage.
   */
  const getMemoryUsage = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetMemoryUsageResponse,
      GetMemoryUsageError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/memory",
    });
  };

  /**
   * Get Threads
   * Return count and names of active threads.
   */
  const getThreads = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetThreadsResponse,
      GetThreadsError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/threads",
    });
  };

  /**
   * Get Container Limits
   * Return container resource limits from cgroup.
   */
  const getContainerLimits = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetContainerLimitsResponse,
      GetContainerLimitsError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/limits",
    });
  };

  /**
   * List Installed Packages
   * Return a list of installed packages and versions.
   */
  const getDependencies = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetDependenciesData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetDependenciesResponse,
      GetDependenciesError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/dependencies",
    });
  };

  /**
   * Get Ohlcv
   * Retrieve OHLCV (Open, High, Low, Close, Volume) data for a specific market, timeframe, and symbol.
   */
  const getOhlcv = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetOhlcvData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetOhlcvResponse,
      GetOhlcvError,
      ThrowOnError
    >({
      ...options,
      url: "/ohlcv",
    });
  };

  /**
   * Funding Rate
   * Retrieve funding rate data for a specific symbol in the futures market.
   */
  const getFundingRates = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetFundingRatesData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetFundingRatesResponse,
      GetFundingRatesError,
      ThrowOnError
    >({
      ...options,
      url: "/funding",
    });
  };

  /**
   * Symbols
   * Retrieve a list of whitelisted symbols for a specific market.
   */
  const getKlinesSymbols = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetKlinesSymbolsData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetKlinesSymbolsResponse,
      GetKlinesSymbolsError,
      ThrowOnError
    >({
      ...options,
      url: "/symbols",
    });
  };

  /**
   * Get Change In Timeframe
   * Retrieve price change percentage between last two completed timestamps for all pairs.
   */
  const getChangeInTimeframe = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetChangeInTimeframeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetChangeInTimeframeResponse,
      GetChangeInTimeframeError,
      ThrowOnError
    >({
      ...options,
      url: "/change",
    });
  };

  return {
    ping,
    getTime,
    getUdfConfig,
    searchSymbols,
    getSymbol,
    getUdfHistory,
    getSymbolInfo,
    optionsHandler,
    getLogLevel,
    getUptime,
    getMemoryUsage,
    getThreads,
    getContainerLimits,
    getDependencies,
    getOhlcv,
    getFundingRates,
    getKlinesSymbols,
    getChangeInTimeframe,
  };
}
