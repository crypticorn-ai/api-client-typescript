import {
  createClient as createNativeClient,
  createConfig,
  type OptionsLegacyParser,
} from "@hey-api/client-fetch";

import type {
  PingError,
  PingResponse,
  GetTimeData,
  GetTimeError,
  GetTimeResponse,
  GetConfigError,
  GetConfigResponse,
  GetUdfConfigError,
  GetUdfConfigResponse,
  SearchSymbolsData,
  SearchSymbolsError,
  SearchSymbolsResponse,
  GetSymbolData,
  GetSymbolError,
  GetSymbolResponse,
  GetUdfHistoryData,
  GetUdfHistoryError,
  GetUdfHistoryResponse,
  GetSymbolInfoData,
  GetSymbolInfoError,
  GetSymbolInfoResponse,
  OptionsHandlerData,
  OptionsHandlerError,
  OptionsHandlerResponse,
  GetOhlcvData,
  GetOhlcvError,
  GetOhlcvResponse,
  GetFundingRatesData,
  GetFundingRatesError,
  GetFundingRatesResponse,
  GetKlinesSymbolsData,
  GetKlinesSymbolsError,
  GetKlinesSymbolsResponse,
  GetChangeInTimeframeData,
  GetChangeInTimeframeError,
  GetChangeInTimeframeResponse,
} from "./types.gen";

export function createClient(
  baseUrl: string,
  headers: any,
  fetch = globalThis.fetch,
) {
  const client = createNativeClient(
    createConfig({
      baseUrl,
      fetch,
      headers,
    }),
  );

  // This file is auto-generated by @hey-api/openapi-ts

  /**
   * Ping
   * Returns 'OK' if the API is running.
   */
  const ping = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      PingResponse,
      PingError,
      ThrowOnError
    >({
      ...options,
      url: "/",
    });
  };

  /**
   * Time
   * Returns the current time in the specified format.
   */
  const getTime = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetTimeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetTimeResponse,
      GetTimeError,
      ThrowOnError
    >({
      ...options,
      url: "/time",
    });
  };

  /**
   * Config
   * Returns the version of the crypticorn library and the environment.
   */
  const getConfig = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetConfigResponse,
      GetConfigError,
      ThrowOnError
    >({
      ...options,
      url: "/config",
    });
  };

  /**
   * Get Config
   */
  const getUdfConfig = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetUdfConfigResponse,
      GetUdfConfigError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/config",
    });
  };

  /**
   * Search Symbols
   * Called when a user searches for symbols in TradingView
   */
  const searchSymbols = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<SearchSymbolsData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      SearchSymbolsResponse,
      SearchSymbolsError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/search",
    });
  };

  /**
   * Get Symbol
   */
  const getSymbol = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetSymbolData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetSymbolResponse,
      GetSymbolError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/symbols",
    });
  };

  /**
   * Get History
   */
  const getUdfHistory = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetUdfHistoryData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetUdfHistoryResponse,
      GetUdfHistoryError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/history",
    });
  };

  /**
   * @deprecated
   * Get Symbol Info
   * Handle symbol info requests for different groups
   */
  const getSymbolInfo = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetSymbolInfoData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetSymbolInfoResponse,
      GetSymbolInfoError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/symbol_info",
    });
  };

  /**
   * Options Handler
   * Handle OPTIONS requests for all UDF endpoints
   */
  const optionsHandler = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<OptionsHandlerData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).options<
      OptionsHandlerResponse,
      OptionsHandlerError,
      ThrowOnError
    >({
      ...options,
      url: "/udf/{path}",
    });
  };

  /**
   * Get Ohlcv
   * Retrieve OHLCV (Open, High, Low, Close, Volume) data for a specific market, timeframe, and symbol.
   */
  const getOhlcv = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetOhlcvData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetOhlcvResponse,
      GetOhlcvError,
      ThrowOnError
    >({
      ...options,
      url: "/{market}/{timeframe}/{symbol}",
    });
  };

  /**
   * Funding Rate
   * Retrieve funding rate data for a specific symbol in the futures market.
   */
  const getFundingRates = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetFundingRatesData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetFundingRatesResponse,
      GetFundingRatesError,
      ThrowOnError
    >({
      ...options,
      url: "/funding_rates/{symbol}",
    });
  };

  /**
   * Symbols
   * Retrieve a list of whitelisted symbols for a specific market.
   */
  const getKlinesSymbols = <ThrowOnError extends boolean = false>(
    options: OptionsLegacyParser<GetKlinesSymbolsData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetKlinesSymbolsResponse,
      GetKlinesSymbolsError,
      ThrowOnError
    >({
      ...options,
      url: "/symbols/{market}",
    });
  };

  /**
   * Get Change In Timeframe
   * Retrieve price change percentage between last two completed timestamps for all pairs.
   *
   * Valid markets: spot, futures
   * Valid timeframes: 15m, 30m, 1h, 4h, 1d
   */
  const getChangeInTimeframe = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetChangeInTimeframeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetChangeInTimeframeResponse,
      GetChangeInTimeframeError,
      ThrowOnError
    >({
      ...options,
      url: "/change",
    });
  };

  return {
    ping,
    getTime,
    getConfig,
    getUdfConfig,
    searchSymbols,
    getSymbol,
    getUdfHistory,
    getSymbolInfo,
    optionsHandler,
    getOhlcv,
    getFundingRates,
    getKlinesSymbols,
    getChangeInTimeframe,
  };
}
