import {
  createClient as createNativeClient,
  createConfig,
  type OptionsLegacyParser,
} from "@hey-api/client-fetch";

import type {
  GetSignalsData,
  GetSignalsError,
  GetSignalsResponse,
  GetTopSignalsData,
  GetTopSignalsError,
  GetTopSignalsResponse,
  PingError,
  PingResponse,
  GetTimeData,
  GetTimeError,
  GetTimeResponse,
  GetLogLevelError,
  GetLogLevelResponse,
  GetUptimeData,
  GetUptimeError,
  GetUptimeResponse,
  GetMemoryUsageError,
  GetMemoryUsageResponse,
  GetThreadsError,
  GetThreadsResponse,
  GetContainerLimitsError,
  GetContainerLimitsResponse,
  GetDependenciesData,
  GetDependenciesError,
  GetDependenciesResponse,
  GetMetricsError,
  GetMetricsResponse,
} from "./types.gen";

export function createClient(
  baseUrl: string,
  headers: any,
  fetch = globalThis.fetch,
) {
  const client = createNativeClient(
    createConfig({
      baseUrl,
      fetch,
      headers,
    }),
  );

  // This file is auto-generated by @hey-api/openapi-ts

  /**
   * Get Signals
   * Get all signals. Returns the latest 100 signals by default.
   * The default sort is `called_at` and the default order is `desc`.
   */
  const getSignals = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetSignalsData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetSignalsResponse,
      GetSignalsError,
      ThrowOnError
    >({
      ...options,
      url: "/signals",
    });
  };

  /**
   * Get Top Signals
   * Get the top performing signals from the last X hours.
   * The default is from the last 24 hours.
   */
  const getTopSignals = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetTopSignalsData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetTopSignalsResponse,
      GetTopSignalsError,
      ThrowOnError
    >({
      ...options,
      url: "/signals/top",
    });
  };

  /**
   * Ping
   * Returns 'OK' if the API is running.
   */
  const ping = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      PingResponse,
      PingError,
      ThrowOnError
    >({
      ...options,
      url: "/",
    });
  };

  /**
   * Time
   * Returns the current time in either ISO or Unix timestamp (seconds) format.
   */
  const getTime = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetTimeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetTimeResponse,
      GetTimeError,
      ThrowOnError
    >({
      ...options,
      url: "/time",
    });
  };

  /**
   * @deprecated
   * Get Logging Level
   * Get the log level of the server logger. Will be removed in a future release.
   */
  const getLogLevel = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetLogLevelResponse,
      GetLogLevelError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/log-level",
    });
  };

  /**
   * Get Uptime
   * Return the server uptime in seconds or human-readable form.
   */
  const getUptime = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetUptimeData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetUptimeResponse,
      GetUptimeError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/uptime",
    });
  };

  /**
   * Get Memory Usage
   * Resident Set Size (RSS) in MB â€” the actual memory used by the process in RAM.
   * Represents the physical memory footprint. Important for monitoring real usage.
   */
  const getMemoryUsage = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetMemoryUsageResponse,
      GetMemoryUsageError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/memory",
    });
  };

  /**
   * Get Threads
   * Return count and names of active threads.
   */
  const getThreads = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetThreadsResponse,
      GetThreadsError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/threads",
    });
  };

  /**
   * Get Container Limits
   * Return container resource limits from cgroup.
   */
  const getContainerLimits = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetContainerLimitsResponse,
      GetContainerLimitsError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/limits",
    });
  };

  /**
   * List Installed Packages
   * Return a list of installed packages and versions.
   *
   * The include parameter accepts regex patterns to match against package names.
   * For example:
   * - crypticorn.* will match all packages starting with 'crypticorn'
   * - .*tic.* will match all packages containing 'tic' in their name
   */
  const getDependencies = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<GetDependenciesData, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetDependenciesResponse,
      GetDependenciesError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/dependencies",
    });
  };

  /**
   * Metrics
   * Get Prometheus metrics for the application. Returns plain text.
   */
  const getMetrics = <ThrowOnError extends boolean = false>(
    options?: OptionsLegacyParser<unknown, ThrowOnError>,
  ) => {
    return (options?.client ?? client).get<
      GetMetricsResponse,
      GetMetricsError,
      ThrowOnError
    >({
      ...options,
      url: "/admin/metrics",
    });
  };

  return {
    getSignals,
    getTopSignals,
    ping,
    getTime,
    getLogLevel,
    getUptime,
    getMemoryUsage,
    getThreads,
    getContainerLimits,
    getDependencies,
    getMetrics,
  };
}
