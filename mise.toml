[tools]
node = "24"
pnpm = "10"

[tasks.pre-commit]
run = "uvx pre-commit run --all-files"
alias = "pc"
description = "Run all pre-commit hooks (alias: 'pc')"

[tasks.test]
run = "pnpm run test"
description = "Run tests"

[tasks."test:cov"]
run = "pnpm run test:cov"
description = "Run tests with coverage"

[tasks.install]
run = "pnpm install"
alias = "i"
description = "Install dependencies (alias: 'i')"

[tasks."install:upgrade"]
run = "pnpm --package=npm-check-updates dlx ncu -i --format group"
description = "Upgrade dependencies"

[tasks.setup]
run = ["mise install", "pnpm install", "uvx pre-commit install"]
description = "Setup the project"

[tasks.build]
run = "pnpm run build"
description = "Build the package"

[tasks.generate]
description = "Generate API clients (alias: 'g')"
usage = '''
arg "service" "Service to generate (trade, hive, auth, metrics, dex, notification, pay)"
flag "--env <env>" "Environment (local, dev, prod)" default="local"
flag "--version <version>" "API version (v1, v2)" default="v1"
'''
alias = "g"
run = "pnpm run generate --service {{arg(name='service')}} --env {{flag(name='env')}} --version {{flag(name='version')}}"

[tasks.clean]
run = "rm -rf dist/ node_modules/.cache/ coverage/"
description = "Clean build artifacts and cache files"

[tasks."link:auth"]
run = "pnpm link ../../auth-service/packages/api"
description = "Link the auth-service API client"
